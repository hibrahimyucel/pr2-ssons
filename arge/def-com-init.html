<!DOCTYPE html>
<html>
<head>
  <title>DEF.COM - Giri≈ü Kontrol</title>
</head>
<body>
  <h1>üîê DEF.COM</h1>
  <div id="result">Kontrol ediliyor...</div>

  <script>
    const AUTH_SERVICE = 'http://auth-service.com';

    async function checkTokenFromABC() {
      try {
        // abc.com'dan ge√ßici token (URL'de veya session'da)
        let accessToken = localStorage.getItem('accessToken');

        if (!accessToken) {
          // abc.com'dan gelmi≈üse URL'de olabilir
          const params = new URLSearchParams(window.location.search);
          accessToken = params.get('token');

          if (!accessToken) {
            document.getElementById('result').innerHTML = `
              ‚ùå Oturum bilgisi bulunamadƒ±<br>
              <a href="http://abc.com:3000">ABC.COM'da Giri≈ü Yap ‚Üí</a>
            `;
            return;
          }
        }

        // Auth Service'e token doƒürulatma iste
        const response = await fetch(`${AUTH_SERVICE}/api/auth/get-tokens`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${accessToken}`
          },
          credentials: 'include'
        });

        const data = await response.json();

        if (response.ok && data.success) {
          // Token ge√ßerli! DEF.COM'da oturum a√ß
          localStorage.setItem('accessToken', data.accessToken);
          localStorage.setItem('deviceId', 'device_def_' + Date.now());

          document.getElementById('result').innerHTML = `
            ‚úÖ DEF.COM'da oturum a√ßtƒ±nƒ±z!<br>
            Kullanƒ±cƒ±: ${data.user.email}<br>
            <br>
            <a href="/dashboard">Dashboard'a Git ‚Üí</a>
          `;
        } else {
          document.getElementById('result').innerHTML = `
            ‚ùå Token ge√ßersiz: ${data.error}<br>
            <a href="http://abc.com:3000">Tekrar Giri≈ü Yap ‚Üí</a>
          `;
        }
      } catch (error) {
        document.getElementById('result').innerHTML = `
          ‚ùå Hata: ${error.message}<br>
          <a href="http://abc.com:3000">ABC.COM'da Giri≈ü Yap ‚Üí</a>
        `;
      }
    }

    // Sayfa y√ºklendiƒüinde kontrol et
    window.onload = checkTokenFromABC;
  </script>
</body>
</html>