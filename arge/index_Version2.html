<!DOCTYPE html>
<html>
<head>
  <title>Auth Service - HTTP-Only Cookies</title>
</head>
<body>
  <h1>Auth Service Test</h1>
  
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Åifre">
  <input type="text" id="name" placeholder="Ad (KayÄ±t iÃ§in)">
  
  <button onclick="register()">KayÄ±t Ol</button>
  <button onclick="login()">GiriÅŸ Yap</button>
  <button onclick="getProfile()">Profili GÃ¶r</button>
  <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ Yap</button>

  <div id="result"></div>

  <script>
    const authServiceUrl = 'http://localhost:3000';
    let deviceId = localStorage.getItem('deviceId');
    
    if (!deviceId) {
      deviceId = 'device_' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('deviceId', deviceId);
    }

    async function register() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const name = document.getElementById('name').value;

      const response = await fetch(`${authServiceUrl}/api/auth/register`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Device-ID': deviceId
        },
        credentials: 'include', // â† Cookie'leri gÃ¶nder/al
        body: JSON.stringify({ email, password, name })
      });

      const data = await response.json();
      
      if (response.ok) {
        // Token localStorage'da DEÄIL, cookie'de!
        document.getElementById('result').innerHTML = `
          âœ… KayÄ±t baÅŸarÄ±lÄ±! HoÅŸgeldiniz, ${data.user.name}
        `;
      } else {
        document.getElementById('result').innerHTML = `âŒ Hata: ${data.error}`;
      }
    }

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const response = await fetch(`${authServiceUrl}/api/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Device-ID': deviceId
        },
        credentials: 'include', // â† HTTP-Only cookie'leri al
        body: JSON.stringify({ email, password })
      });

      const data = await response.json();
      
      if (response.ok) {
        document.getElementById('result').innerHTML = `
          âœ… GiriÅŸ baÅŸarÄ±lÄ±! HoÅŸgeldiniz, ${data.user.name}
        `;
      } else {
        document.getElementById('result').innerHTML = `âŒ Hata: ${data.error}`;
      }
    }

    async function getProfile() {
      const response = await fetch(`${authServiceUrl}/api/auth/me`, {
        credentials: 'include', // â† Cookie'leri otomatik gÃ¶nder
      });

      if (response.ok) {
        const user = await response.json();
        document.getElementById('result').innerHTML = JSON.stringify(user, null, 2);
      } else {
        document.getElementById('result').innerHTML = 'âŒ Profil alÄ±namadÄ±';
      }
    }

    async function logout() {
      const response = await fetch(`${authServiceUrl}/api/auth/logout`, {
        method: 'POST',
        headers: {
          'X-Device-ID': deviceId
        },
        credentials: 'include' // â† Cookie'leri gÃ¶nder
      });

      const data = await response.json();
      document.getElementById('result').innerHTML = 'âœ… ' + data.message;
    }

    // DevTools Console'da bakarak token gÃ¶remeyeceÄŸiz!
    console.log('localStorage.getItem("accessToken"):', localStorage.getItem('accessToken')); // null
    console.log('HTTP-Only cookies tarayÄ±cÄ± tarafÄ±ndan gizleniyor ğŸ”’');
  </script>
</body>
</html>